<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Products</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="homepage">
    <header>
        <a href="{{ url_for('home') }}" class="home-icon">üè†</a>
        <div class="search-container">
            <form method="get" action="{{ url_for('search') }}" class="search-form">
                <input type="text" name="q" value="{{ search_query }}" placeholder="Search guitars... (eg. Fender Stratocaster)" class="search-input">
                <select name="category" class="category-select" style="padding: 12px 20px; border: 2px solid #f67280; border-radius: 30px; margin: 0 10px; font-size: 16px; outline: none; background-color: white; color: #555; cursor: pointer;">
                    <option value="">All Categories</option>
                    {% for cat in categories %}
                    <option value="{{ cat['category'] }}" {% if selected_category == cat['category'].lower() %}selected{% endif %}>{{ cat['category'] }}</option>
                    {% endfor %}
                </select>
                <button type="submit" class="search-button">Search</button>
            </form>
        </div>
        {% if current_user.is_authenticated %}
            <div class="user-menu">
                <span class="welcome-user">Welcome, {{ current_user.username }}!</span>
                <a href="{{ url_for('shopping_cart') }}" class="cart-button" aria-label="Shopping Cart">
                    üõí Cart
                    <span class="cart-count">{{ cart_items|length }}</span>
                </a>
                <a href="{{ url_for('profile') }}" class="profile-link">Profile</a>
                <form method="post" action="{{ url_for('logout') }}" class="logout-form-inline">
                    <button type="submit" class="logout-btn">Logout</button>
                </form>
            </div>
        {% else %}
            <div class="auth-menu">
                <a href="{{ url_for('login') }}" class="auth-link login-link">Login</a>
                <a href="{{ url_for('register') }}" class="auth-link register-link">Register</a>
            </div>
        {% endif %}
    </header>

    <main class="dashboard" style="max-width: 1400px; margin: 0 auto; padding: 0 20px 60px;">
        <div style="grid-column: 1 / -1; margin-bottom: 20px;">
            <div class="sort-options" style="display: flex; gap: 15px; align-items: center; background: white; padding: 15px 25px; border-radius: 16px; box-shadow: 0 4px 12px rgba(196, 63, 86, 0.1);">
                <span style="font-weight: 600; color: #b7374a;">Sort by:</span>
                <a href="{{ url_for('search', q=search_query, category=selected_category, sort='name', order='asc') }}" 
                   class="sort-option {% if sort_by == 'name' and sort_order == 'asc' %}active{% endif %}"
                   style="padding: 8px 16px; border-radius: 20px; background: #f8f8f8; color: #555; text-decoration: none; font-weight: 500; transition: all 0.3s ease;">
                    Name (A-Z)
                </a>
                <a href="{{ url_for('search', q=search_query, category=selected_category, sort='price', order='asc') }}" 
                   class="sort-option {% if sort_by == 'price' and sort_order == 'asc' %}active{% endif %}"
                   style="padding: 8px 16px; border-radius: 20px; background: #f8f8f8; color: #555; text-decoration: none; font-weight: 500; transition: all 0.3s ease;">
                    Price (Low-High)
                </a>
                <a href="{{ url_for('search', q=search_query, category=selected_category, sort='price', order='desc') }}" 
                   class="sort-option {% if sort_by == 'price' and sort_order == 'desc' %}active{% endif %}"
                   style="padding: 8px 16px; border-radius: 20px; background: #f8f8f8; color: #555; text-decoration: none; font-weight: 500; transition: all 0.3s ease;">
                    Price (High-Low)
                </a>
            </div>
        </div>

        <div class="products-grid" style="grid-column: 1 / -1; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px;">
            {% for product in products %}
            <div class="product-card" style="background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 8px 20px rgba(196, 63, 86, 0.12); transition: all 0.3s ease; display: flex; flex-direction: column; height: 100%; cursor: pointer;"
                onmouseover="this.style.background='linear-gradient(135deg, #ffebee 0%, #fce4ec 100%)'; this.style.boxShadow='0 12px 30px rgba(196, 63, 86, 0.25)'; this.style.transform='translateY(-5px)';"
                onmouseout="this.style.background='white'; this.style.boxShadow='0 8px 20px rgba(196, 63, 86, 0.12)'; this.style.transform='translateY(0)';">
                <a href="{{ url_for('product_detail', product_id=product['id']) }}" class="product-link" style="text-decoration: none; color: inherit; display: flex; flex-direction: column; flex: 1;">
                    <div style="height: 200px; overflow: hidden; background: #f9f9f9; display: flex; align-items: center; justify-content: center;">
                        <img src="{{ product['image_url'] or url_for('static', filename='Images/FILLER.png') }}" 
                             alt="{{ product['name'] }}" 
                             style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease;">
                    </div>
                    <div class="product-info" style="padding: 20px; flex: 1; display: flex; flex-direction: column;">
                        <h3 class="product-name" style="margin: 0 0 8px 0; font-size: 1.2rem; color: #333; font-weight: 600;">{{ product['name'] }}</h3>
                        <p class="product-category" style="margin: 0 0 12px 0; font-size: 0.9rem; color: #d65c6f; font-weight: 500;">{{ product['category'] }}</p>
                        <p class="product-price" style="margin: auto 0 0 0; font-size: 1.4rem; font-weight: 700; color: #b7374a;">
                            ${{ "%.2f"|format(product['price']) }}
                        </p>
                    </div>
                </a>
                <div class="product-actions" style="padding: 0 20px 20px 20px;">
                    {% if product['stock'] > 0 %}
                        <p class="in-stock" style="margin: 0 0 12px 0; color: #2e7d32; font-size: 0.9rem; font-weight: 500;">
                            In Stock ({{ product['stock'] }})
                        </p>
                        <a href="{{ url_for('product_detail', product_id=product['id']) }}" 
                           class="view-details-btn"
                           style="display: inline-block; width: 90%; padding: 12px; background: linear-gradient(45deg, #f67280, #f79489); color: white; text-decoration: none; border-radius: 30px; font-weight: 600; text-align: center; transition: all 0.3s ease; margin: 0 auto;">
                            View Details
                        </a>
                    {% else %}
                        <p class="out-of-stock" style="margin: 0; color: #d32f2f; font-weight: 500; text-align: center; padding: 12px 0;">
                            Out of Stock
                        </p>
                    {% endif %}
                </div>
            </div>
            {% else %}
            <div class="no-results" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; background: white; border-radius: 16px; box-shadow: 0 8px 20px rgba(196, 63, 86, 0.1);">
                <h3 style="color: #b7374a; font-size: 1.5rem; margin-bottom: 15px;">No products found</h3>
                <p style="color: #666; font-size: 1.1rem;">Try adjusting your search or browse our <a href="{{ url_for('home') }}" style="color: #d65c6f; font-weight: 500; text-decoration: none;">homepage</a>.</p>
            </div>
            {% endfor %}
        </div>
    </main>
    </body>
</html>
